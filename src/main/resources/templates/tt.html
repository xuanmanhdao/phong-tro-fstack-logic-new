<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{landlord/layouts/default}">
<div class="container-fluid" layout:fragment="content">

  <section class="section">
    <div class="section-header"><div class="section-title">Hình ảnh</div></div>
    <div class="section-content">
      <div class="form-group">
        <div for="browse_photos" class="browse_photos js-dropzone"><i class="icon-upload-image"></i><span class="js-btn-chon-anh">Chọn ảnh</span></div>
      </div>
      <div class="list-photos-upload clearfix dropzone-previews" id="list-photos-dropzone-previews"></div>
      <div id="tpl" style="display:none">
        <div class="photo_item js-photo-manual">
          <div class="photo"><img data-dz-thumbnail /></div>
          <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
          <div class="bottom clearfix">
            <span class="photo_delete" data-dz-remove><i></i> Xóa</span>
          </div>
          <input name="" value="" type="hidden"/>
        </div>
      </div>
    </div>
  </section>
  <script>
    uploadImage: function(){
      if(typeof Dropzone === 'undefined') return;
      if($('.js-dropzone').length ==0) return;
      // INIT DROPZONE
      var self = this;
      var btn_submit = $(".js-form-submit-data").find('button[type="submit"]');
      var btn_chon_anh = $('.js-btn-chon-anh');
      var btn_chon_anh_text = btn_chon_anh.html();
      var dropzoneOptions = {
        url: "https://static123.com/api/upload",
        acceptedFiles:".jpg,.jpeg,.png",
        maxFilesize: 10,
        maxFiles: 20,
        previewsContainer:'#list-photos-dropzone-previews',
        previewTemplate: $('#tpl').length > 0 ? document.querySelector('#tpl').innerHTML : '',
        dictRemoveFileConfirmation:"Bạn chắc chắn muốn xóa hình ảnh này?"
      };

      var myDropzone = new Dropzone(".js-dropzone", dropzoneOptions);

      var _window_with = $(document).width();
      var _action = 'click';
      if(_window_with <= 480){
        _action = 'touchstart tap';
      }

      $('#list-photos-dropzone-previews').sortable();
      // Bind manual remove
      $('#list-photos-dropzone-previews').on(_action, '.js-photo-manual .photo_delete', function(event){
        var _self = $(this);
        if (myDropzone.options.dictRemoveFileConfirmation) {
          return Dropzone.confirm(myDropzone.options.dictRemoveFileConfirmation, function() {
            _self.closest('.js-photo-manual').remove();
          });
        }else{
          $(this).closest('.js-photo-manual').remove();
        }
      });

      myDropzone.on('error', function(file, message){
        if (file.size > myDropzone.options.maxFilesize * 1024 * 1024) {
          Swal.fire('Lỗi', 'Video tối đa được upload '+myDropzone.options.maxFilesize+'MB', 'error');
          myDropzone.removeFile(file);
          return;
        }
        Swal.fire('Lỗi', message, 'error');
        myDropzone.removeFile(file);
      });

      myDropzone.on('sending', function(file, xhr, formData){
        formData.append('source', 'phongtro123');
        formData.append('source_url', window.location.href);
        formData.append('from', 'dangtin');
        btn_submit.addClass('disabled');
        btn_chon_anh.html('Đang đăng hình...');
      });

      myDropzone.on("addedfile", function(file, response) {
        if($('.js-photo-manual').length > 20){
          Swal.fire('Lỗi', 'Bạn chỉ được đăng tải 20 hình ảnh. Vui lòng xóa để đăng lại', 'error');
          myDropzone.removeFile(file);

        }
      });

      myDropzone.on("success", function(file, response) {
        //
        self.images.push(file);
        var el_preview = $(file.previewElement);
        el_preview.append('<input type="hidden" name="image_linked['+response.id+']" value="'+response.image_path+'"/>');
      });

      myDropzone.on("complete", function(file) {
        btn_submit.removeClass('disabled');
        btn_chon_anh.html(btn_chon_anh_text);
      });

    }

  </script>



  <div>

    <!--<div class="container-fluid" layout:fragment="content">-->

    <!--    <div class="row d-flex justify-content-center">-->
    <!--        <div class="col-md-10">-->
    <!--            <div class="wizard">-->
    <!--                <div class="wizard-inner" >-->
    <!--                    <div class="connecting-line"></div>-->
    <!--                    <ul class="nav nav-tabs" id="tab_logic" role="tablist">-->
    <!--                        <li role="presentation" class="active" id="step1">-->
    <!--                            <a href="#step1" data-toggle="tab"   aria-controls="step1" role="tab"-->
    <!--                               aria-expanded="true">-->
    <!--                                <span class="round-tab">1 </span>-->
    <!--                                <i>Thông tin cơ bản</i></a>-->
    <!--                        </li>-->
    <!--                        <li role="presentation" class="active" id="step2"></li>-->
    <!--                    </ul>-->
    <!--                </div>-->

    <!--                <form role="form" class="login-box" id="post-news">-->
    <!--                    <div class="tab-content" id="main_form">-->
    <!--                        <div class="tab-pane active" role="tabpanel"  id="step">-->
    <!--                            <h4 class="text-center">Thông tin cơ bản</h4>-->


    <!--                        </div>-->
    <!--                            <ul class="list-inline pull-right">-->
    <!--                            <li>-->
    <!--                                <button type="button" class="default-btn prev-step">Back</button>-->
    <!--                            </li>-->

    <!--                                    <a id="add_row" class="btn btn-success pull-left">Add Row</a>                                </li>-->

    <!--                                <button type="button" class="default-btn next-step">Finish</button>-->
    <!--                            </li>-->
    <!--                        </ul>-->
    <!--                        <div class="clearfix"></div>-->
    <!--                    </div>-->

    <!--                </form>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--    </div>-->


  </div>
</div>

</html>